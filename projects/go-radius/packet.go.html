<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>~/code/stayke.net/src/go-radius/packet.go.html</title>
<meta name="Generator" content="Vim/7.4">
<meta name="plugin-version" content="vim7.4_v1">
<meta name="syntax" content="go">
<meta name="settings" content="dynamic_folds,no_pre,use_css,expand_tabs,prevent_copy=">
<meta name="colorscheme" content="ir_black">
<style type="text/css">
<!--
body { color: #cecece; background-color: black; font-family: monospace; }
* { font-size: 1em; }
.Type { color: #FFFFB6; text-decoration: underline; }
.Statement { color: #6699CC; font-weight: bold; }
.Conditional { color: #6699CC; }
.Number { color: #FF73FD; }
.Keyword { color: #96CBFE; }
.FoldColumn { color: Cyan; background-color: Grey; padding-bottom: 1px; }
.Comment { color: #A8FF60; font-weight: bold; }
.String { color: #A8FF60; }
.FoldColumn { text-decoration: none; white-space: pre; }
.open-fold   .Folded      { display: none; }
.open-fold   .fulltext      { display: inline; }
.open-fold   .toggle-open   { display: none; }
.closed-fold .toggle-closed { display: inline; }

.closed-fold .fulltext      { display: none; }
.closed-fold .Folded      { display: inline; }
.closed-fold .toggle-open   { display: inline; }
.closed-fold .toggle-closed { display: none; }
-->
</style>

<script type='text/javascript'>
<!--

function toggleFold(objID)
{
  var fold;
  fold = document.getElementById(objID);
  if(fold.className == 'closed-fold')
  {
    fold.className = 'open-fold';
  }
  else if (fold.className == 'open-fold')
  {
    fold.className = 'closed-fold';
  }
}

-->
</script>
</head>
<body>
<div id='vimCodeElement'>
<span class="Statement">package</span>&nbsp;radius<br>
<br>
<span class="Statement">import</span>&nbsp;(<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="String">&quot;math/rand&quot;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="String">&quot;net&quot;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="String">&quot;time&quot;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="String">&quot;encoding/binary&quot;</span><br>
)<br>
<br>
<span class="Comment">// incrementing packet identification</span><br>
<span class="Keyword">var</span>&nbsp;ident&nbsp;<span class="Type">uint8</span><br>
<br>
<span class="Keyword">type</span>&nbsp;Packet&nbsp;<span class="Keyword">struct</span>&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;buff []<span class="Type">byte</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;read&nbsp;<span class="Type">int</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;addr *net.UDPAddr<br>
&nbsp;&nbsp;&nbsp;&nbsp;err&nbsp;&nbsp;<span class="Type">error</span><br>
}<br>
<br>
<span class="Keyword">func</span>&nbsp;NewPacket(code, ident&nbsp;<span class="Type">uint8</span>, auth []<span class="Type">byte</span>, ats ...Attribute) Packet {<br>
&nbsp;&nbsp;&nbsp;&nbsp;buff :=&nbsp;<span class="Keyword">make</span>([]<span class="Type">byte</span>,&nbsp;<span class="Number">6</span>)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;buff[<span class="Number">0</span>] =&nbsp;<span class="Type">byte</span>(code)<br>
&nbsp;&nbsp;&nbsp;&nbsp;buff[<span class="Number">1</span>] =&nbsp;<span class="Type">byte</span>(ident)<br>
&nbsp;&nbsp;&nbsp;&nbsp;buff[<span class="Number">3</span>] = auth[<span class="Number">0</span>]<br>
&nbsp;&nbsp;&nbsp;&nbsp;buff[<span class="Number">4</span>] = auth[<span class="Number">1</span>]<br>
}<br>
<br>
<span class="Keyword">func</span>&nbsp;AuthPacket(ats ...Attribute) Packet {<br>
&nbsp;&nbsp;&nbsp;&nbsp;ident +=&nbsp;<span class="Number">1</span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;c := Access_Request<br>
&nbsp;&nbsp;&nbsp;&nbsp;i := ident<br>
&nbsp;&nbsp;&nbsp;&nbsp;authenticator := DefaultAuthenticator()<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Statement">return</span>&nbsp;NewPacket(c, i, authenticator)<br>
}<br>
<br>
<span class="Keyword">const</span>&nbsp;(<br>
&nbsp;&nbsp;&nbsp;&nbsp;Invalid_Type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Type">uint8</span>&nbsp;=&nbsp;<span class="Number">0</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;Access_Request&nbsp;&nbsp;&nbsp;<span class="Type">uint8</span>&nbsp;=&nbsp;<span class="Number">1</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;Access_Accept&nbsp;&nbsp;&nbsp;&nbsp;<span class="Type">uint8</span>&nbsp;=&nbsp;<span class="Number">2</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;Access_Reject&nbsp;&nbsp;&nbsp;&nbsp;<span class="Type">uint8</span>&nbsp;=&nbsp;<span class="Number">3</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;Access_Challange&nbsp;<span class="Type">uint8</span>&nbsp;=&nbsp;<span class="Number">11</span><br>
)<br>
<br>
<span class="Keyword">const</span>&nbsp;(<br>
&nbsp;&nbsp;&nbsp;&nbsp;code&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Type">int</span>&nbsp;=&nbsp;<span class="Number">0</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;identifier&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;<span class="Number">1</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;len_start&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =&nbsp;<span class="Number">2</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;len_end&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =&nbsp;<span class="Number">3</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;authenticator_start&nbsp;&nbsp;&nbsp;&nbsp; =&nbsp;<span class="Number">4</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;authenticator_end&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =&nbsp;<span class="Number">20</span><br>
)<br>
<br>
<span class="Keyword">func</span>&nbsp;(p *Packet) Code()&nbsp;<span class="Type">uint8</span>&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;pt := packetType(p.buff[<span class="Number">0</span>])<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Statement">return</span>&nbsp;pt<br>
}<br>
<br>
<span class="Keyword">func</span>&nbsp;(p *Packet) Identifier()&nbsp;<span class="Type">uint8</span>&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Statement">return</span>&nbsp;<span class="Type">uint8</span>(p.buff[<span class="Number">1</span>])<br>
}<br>
<br>
<span class="Keyword">func</span>&nbsp;(p *Packet) Len()&nbsp;<span class="Type">uint8</span>&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Statement">return</span>&nbsp;<span class="Type">uint8</span>(p.buff[<span class="Number">2</span>])<br>
}<br>
<br>
<span class="Keyword">func</span>&nbsp;packetType(code&nbsp;<span class="Type">byte</span>)&nbsp;<span class="Type">uint8</span>&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Conditional">switch</span>&nbsp;<span class="Type">uint8</span>(code) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Statement">case</span>&nbsp;Access_Request:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Statement">return</span>&nbsp;Access_Request<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Statement">case</span>&nbsp;Access_Accept:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Statement">return</span>&nbsp;Access_Accept<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Statement">case</span>&nbsp;Access_Reject:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Statement">return</span>&nbsp;Access_Reject<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Statement">default</span>:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Statement">return</span>&nbsp;Invalid_Type<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
}<br>
<br>
<span class="Comment">// Utility function to generate a pseudo random 2 byte auth</span><br>
<span class="Comment">// Uses time.Now().Unix() as a Source</span><br>
<span class="Keyword">func</span>&nbsp;DefaultAuthenticator() []<span class="Type">byte</span>&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;r := rand.New(rand.NewSource(time.Now().Unix()))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;res :=&nbsp;<span class="Keyword">make</span>([]<span class="Type">byte</span>,&nbsp;<span class="Number">2</span>)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;binary.LittleEndian.PutUint32(res, r.Uint32())<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Statement">return</span>&nbsp;res<br>
}<br>
</div>
</body>
</html>
<!-- vim: set foldmethod=manual : -->
