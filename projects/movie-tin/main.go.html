<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>~/code/stayke.net/src/movie-tin/main.go.html</title>
<meta name="Generator" content="Vim/7.4">
<meta name="plugin-version" content="vim7.4_v1">
<meta name="syntax" content="go">
<meta name="settings" content="dynamic_folds,no_pre,use_css,expand_tabs,prevent_copy=">
<meta name="colorscheme" content="ir_black">
<style type="text/css">
<!--
body { color: #cecece; background-color: black; font-family: monospace; }
* { font-size: 1em; }
.Type { color: #FFFFB6; text-decoration: underline; }
.Statement { color: #6699CC; font-weight: bold; }
.Constant { color: #99CC99; text-decoration: underline; }
.Conditional { color: #6699CC; }
.Number { color: #FF73FD; }
.Keyword { color: #96CBFE; }
.FoldColumn { color: Cyan; background-color: Grey; padding-bottom: 1px; }
.Comment { color: #A8FF60; font-weight: bold; }
.String { color: #A8FF60; }
.Special { color: #E18964; font-weight: bold; }
.Todo { color: #8f8f8f; }
.FoldColumn { text-decoration: none; white-space: pre; }
.open-fold   .Folded      { display: none; }
.open-fold   .fulltext      { display: inline; }
.open-fold   .toggle-open   { display: none; }
.closed-fold .toggle-closed { display: inline; }

.closed-fold .fulltext      { display: none; }
.closed-fold .Folded      { display: inline; }
.closed-fold .toggle-open   { display: inline; }
.closed-fold .toggle-closed { display: none; }
-->
</style>

<script type='text/javascript'>
<!--

function toggleFold(objID)
{
  var fold;
  fold = document.getElementById(objID);
  if(fold.className == 'closed-fold')
  {
    fold.className = 'open-fold';
  }
  else if (fold.className == 'open-fold')
  {
    fold.className = 'closed-fold';
  }
}

-->
</script>
</head>
<body>
<div id='vimCodeElement'>
<span class="Statement">package</span>&nbsp;main<br>
<br>
<span class="Statement">import</span>&nbsp;(<br>
&nbsp;&nbsp;&nbsp;&nbsp;termboxutil&nbsp;<span class="String">&quot;../termboxutil&quot;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="String">&quot;encoding/gob&quot;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="String">&quot;encoding/json&quot;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="String">&quot;errors&quot;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="String">&quot;fmt&quot;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;termbox&nbsp;<span class="String">&quot;github.com/nsf/termbox-go&quot;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="String">&quot;io/ioutil&quot;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="String">&quot;net/http&quot;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="String">&quot;net/url&quot;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="String">&quot;os&quot;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="String">&quot;os/user&quot;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="String">&quot;regexp&quot;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="String">&quot;strings&quot;</span><br>
)<br>
<br>
<span class="Keyword">var</span>&nbsp;titleRegex *regexp.Regexp&nbsp;<span class="Comment">// the regex used to cleanup filenames</span><br>
<span class="Keyword">var</span>&nbsp;cache&nbsp;<span class="Type">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Comment">// cache directory $HOME/.movietin</span><br>
<br>
<span class="Keyword">const</span>&nbsp;(<br>
&nbsp;&nbsp;&nbsp;&nbsp;omdbUrl =&nbsp;<span class="String">&quot;<a href="http://www.omdbapi.com/?%s=%s&amp;plot=full">http://www.omdbapi.com/?%s=%s&amp;plot=full</a>&quot;</span><br>
)<br>
<br>
<span class="Comment">/*</span><br>
<span class="Comment">holds the response from omdbapi */</span><br>
<span class="Keyword">type</span>&nbsp;Movie&nbsp;<span class="Keyword">struct</span>&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;Title, Year, Genre, Director, Actors, Plot, ImdbID&nbsp;<span class="Type">string</span><br>
}<br>
<br>
<span class="Keyword">type</span>&nbsp;SearchResult&nbsp;<span class="Keyword">struct</span>&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;Search []Movie<br>
}<br>
<br>
<span class="Keyword">func</span>&nbsp;cacheLookup(fname&nbsp;<span class="Type">string</span>) (movie Movie, found&nbsp;<span class="Type">error</span>) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;file, openerr := os.OpenFile(strings.Trim(cache + fname,&nbsp;<span class="String">&quot; &quot;</span>), os.O_RDONLY,&nbsp;<span class="Number">0660</span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Conditional">if</span>&nbsp;openerr !=&nbsp;<span class="Keyword">nil</span>&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Statement">return</span>&nbsp;movie, errors.New(<span class="String">&quot;No file in cache &quot;</span>&nbsp;+ cache + fname)<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Statement">defer</span>&nbsp;file.Close()<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;decoder := gob.NewDecoder(file)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Conditional">if</span>&nbsp;err := decoder.Decode(&amp;movie); err !=&nbsp;<span class="Keyword">nil</span>&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Statement">return</span>&nbsp;movie, errors.New(<span class="String">&quot;Failed decoding gob in cache&quot;</span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Statement">return</span><br>
}<br>
<br>
<span class="Keyword">func</span>&nbsp;cacheSave(fname&nbsp;<span class="Type">string</span>, movie Movie)&nbsp;<span class="Type">error</span>&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;file, openerr := os.OpenFile(strings.Trim(cache + fname,&nbsp;<span class="String">&quot; &quot;</span>), os.O_TRUNC|os.O_WRONLY|os.O_CREATE,&nbsp;<span class="Number">0660</span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Conditional">if</span>&nbsp;openerr !=&nbsp;<span class="Keyword">nil</span>&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Statement">return</span>&nbsp;errors.New(<span class="String">&quot;Couldnt open cache for saving&quot;</span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Statement">defer</span>&nbsp;file.Close()<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;encoder := gob.NewEncoder(file)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Conditional">if</span>&nbsp;err := encoder.Encode(movie); err !=&nbsp;<span class="Keyword">nil</span>&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Statement">return</span>&nbsp;errors.New(<span class="String">&quot;Couldnt save cache&quot;</span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Statement">return</span>&nbsp;<span class="Keyword">nil</span><br>
}<br>
<br>
<span class="Keyword">func</span>&nbsp;omdbLookup(url&nbsp;<span class="Type">string</span>) []<span class="Type">byte</span>&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;resp, err := http.Get(url)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Conditional">if</span>&nbsp;err !=&nbsp;<span class="Keyword">nil</span>&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Keyword">panic</span>(err)<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;data, readerr := ioutil.ReadAll(resp.Body)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Conditional">if</span>&nbsp;readerr !=&nbsp;<span class="Keyword">nil</span>&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Keyword">panic</span>(readerr)<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;resp.Body.Close()<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Statement">return</span>&nbsp;data<br>
}<br>
<br>
<span class="Keyword">func</span>&nbsp;main() {<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;cwd, _ := os.Getwd()<br>
&nbsp;&nbsp;&nbsp;&nbsp;dir, _ := os.Open(cwd)<br>
&nbsp;&nbsp;&nbsp;&nbsp;media, err := dir.Readdir(-<span class="Number">1</span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Conditional">if</span>&nbsp;err !=&nbsp;<span class="Keyword">nil</span>&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Keyword">panic</span>(err)<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;u, _ := user.Current()<br>
&nbsp;&nbsp;&nbsp;&nbsp;cache = u.HomeDir +&nbsp;<span class="String">&quot;/.movietin/&quot;</span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Comment">//&nbsp;</span><span class="Todo">TODO</span><span class="Comment">&nbsp;make this cleaner and replace periods etc</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Comment">// regex to cleanup filenames from extensions and misc data</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;titleRegex, _ = regexp.Compile(<span class="String">&quot;[</span><span class="Special">\\</span><span class="String">w</span><span class="Special">\\</span><span class="String">d</span><span class="Special">\\</span><span class="String">s]+&quot;</span>)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Conditional">if</span>&nbsp;err := termbox.Init(); err !=&nbsp;<span class="Keyword">nil</span>&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Keyword">panic</span>(err)<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Statement">defer</span>&nbsp;termbox.Close()<br>
&nbsp;&nbsp;&nbsp;&nbsp;termbox.SetCursor(-<span class="Number">1</span>, -<span class="Number">1</span>)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;filenames :=&nbsp;<span class="Keyword">make</span>([]<span class="Type">string</span>,&nbsp;<span class="Keyword">len</span>(media))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Statement">for</span>&nbsp;i, file :=&nbsp;<span class="Statement">range</span>&nbsp;media {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prettyName := titleRegex.FindString(file.Name())<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cachedImdb, cacherr := cacheLookup(prettyName)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Conditional">if</span>&nbsp;cacherr !=&nbsp;<span class="Keyword">nil</span>&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filenames[i] = prettyName<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="Conditional">else</span>&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filenames[i] = cachedImdb.Title +&nbsp;<span class="String">&quot;</span><span class="Special">\t</span><span class="String">&quot;</span>&nbsp;+ cachedImdb.Year<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;screen := termboxutil.Screen{}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;mainWindow := screen.NewWindow(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;termbox.ColorWhite,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;termbox.ColorDefault,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;termbox.ColorGreen,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;termbox.ColorBlack)<br>
&nbsp;&nbsp;&nbsp;&nbsp;mainWindow.Scrollable(<span class="Keyword">true</span>)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;searchWindow := screen.NewWindow(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;termbox.ColorWhite,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;termbox.ColorDefault,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;termbox.ColorGreen,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;termbox.ColorBlack)<br>
&nbsp;&nbsp;&nbsp;&nbsp;searchWindow.Scrollable(<span class="Keyword">true</span>)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;err = mainWindow.Draw(filenames)<br>
&nbsp;&nbsp;&nbsp;&nbsp;screen.Focus(&amp;mainWindow)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Conditional">if</span>&nbsp;err !=&nbsp;<span class="Keyword">nil</span>&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Keyword">panic</span>(err)<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;termbox.Flush()<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Keyword">var</span>&nbsp;searchResult []Movie<br>
&nbsp;&nbsp;&nbsp;&nbsp;mainWindow.CatchEvent =&nbsp;<span class="Type">func</span>(event termbox.Event) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Conditional">if</span>&nbsp;event.Ch ==&nbsp;<span class="Constant">'j'</span>&nbsp;|| event.Key == termbox.KeyArrowDown {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mainWindow.NextRow()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="Conditional">else</span>&nbsp;<span class="Conditional">if</span>&nbsp;event.Ch ==&nbsp;<span class="Constant">'k'</span>&nbsp;|| event.Key == termbox.KeyArrowUp {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mainWindow.PrevRow()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="Conditional">else</span>&nbsp;<span class="Conditional">if</span>&nbsp;event.Key == termbox.KeyEnter {<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Comment">// do a search for titleRegex match of the filename</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;curRow, _ := mainWindow.CurrentRow()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;searchData := omdbLookup(fmt.Sprintf(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;omdbUrl,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="String">&quot;s&quot;</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;url.QueryEscape(titleRegex.FindString(curRow.Text))))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Keyword">var</span>&nbsp;sr SearchResult<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;err = json.Unmarshal(searchData, &amp;sr)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Conditional">if</span>&nbsp;err !=&nbsp;<span class="Keyword">nil</span>&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Keyword">panic</span>(err)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;searchResult = sr.Search<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;titles :=&nbsp;<span class="Keyword">make</span>([]<span class="Type">string</span>,&nbsp;<span class="Keyword">len</span>(searchResult))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Statement">for</span>&nbsp;i, movie :=&nbsp;<span class="Statement">range</span>&nbsp;searchResult {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;titles[i] = movie.Title<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;searchWindow.Draw(titles)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screen.Focus(&amp;searchWindow)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;termbox.Flush()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Statement">return</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mainWindow.Redraw()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;termbox.Flush()<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;searchWindow.CatchEvent =&nbsp;<span class="Type">func</span>(event termbox.Event) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Conditional">if</span>&nbsp;event.Ch ==&nbsp;<span class="Constant">'j'</span>&nbsp;|| event.Key == termbox.KeyArrowDown {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;searchWindow.NextRow()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="Conditional">else</span>&nbsp;<span class="Conditional">if</span>&nbsp;event.Ch ==&nbsp;<span class="Constant">'k'</span>&nbsp;|| event.Key == termbox.KeyArrowUp {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;searchWindow.PrevRow()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="Conditional">else</span>&nbsp;<span class="Conditional">if</span>&nbsp;event.Key == termbox.KeyEnter {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;currentRow, index := searchWindow.CurrentRow()<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Comment">// do movie lookup by id</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lookupData := omdbLookup(fmt.Sprintf(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;omdbUrl,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="String">&quot;i&quot;</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;searchResult[index].ImdbID))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Keyword">var</span>&nbsp;movie Movie<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;err = json.Unmarshal(lookupData, &amp;movie)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Conditional">if</span>&nbsp;err !=&nbsp;<span class="Keyword">nil</span>&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Keyword">panic</span>(err)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;err = cacheSave(titleRegex.FindString(currentRow.Text), movie)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Conditional">if</span>&nbsp;err !=&nbsp;<span class="Keyword">nil</span>&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Keyword">panic</span>(err)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screen.Focus(&amp;mainWindow)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mainWindow.Redraw()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;termbox.Flush()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Statement">return</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="Conditional">else</span>&nbsp;<span class="Conditional">if</span>&nbsp;event.Ch ==&nbsp;<span class="Constant">'q'</span>&nbsp;|| event.Key == termbox.KeyEsc {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;screen.Focus(&amp;mainWindow)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mainWindow.Redraw()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;termbox.Flush()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Statement">return</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;searchWindow.Redraw()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;termbox.Flush()<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;screen.Loop()<br>
}<br>
</div>
</body>
</html>
<!-- vim: set foldmethod=manual : -->
